[package]
name = "turbomcp-wasm"
version = "3.0.0-beta.2"
edition = "2024"
rust-version = "1.89.0"
authors = ["Nicholas Paterno <nick@epistates.com>"]
description = "WebAssembly bindings for TurboMCP - MCP client for browsers and WASI environments"
license = "MIT"
repository = "https://github.com/Epistates/turbomcp"
homepage = "https://turbomcp.org"
documentation = "https://docs.rs/turbomcp-wasm"
keywords = ["mcp", "wasm", "webassembly", "browser", "wasi"]
categories = ["wasm", "web-programming"]
readme = "README.md"

[lib]
crate-type = ["cdylib", "rlib"]

[features]
default = ["browser"]
# Browser target with wasm-bindgen
browser = ["wasm-bindgen", "wasm-bindgen-futures", "web-sys", "js-sys", "serde-wasm-bindgen", "futures-channel"]
# WASI Preview 2 target - full runtime support for Wasmtime, WasmEdge, etc.
wasi = ["dep:wasi", "dep:wit-bindgen", "dep:url"]
# Console logging for debugging
console-log = ["browser", "console_error_panic_hook"]
# WASM server support - MCP servers running in WASM environments (Cloudflare Workers, etc.)
wasm-server = ["dep:worker", "dep:schemars", "dep:hashbrown", "wasm-bindgen", "wasm-bindgen-futures", "serde-wasm-bindgen", "js-sys"]
# Cloudflare Workers feature alias (same as wasm-server, for clarity)
cloudflare = ["wasm-server"]
# Authentication support for WASM servers (JWT validation via Web Crypto API)
auth = ["wasm-server", "web-sys"]
# Procedural macros for zero-boilerplate WASM MCP server development
macros = ["wasm-server", "dep:turbomcp-wasm-macros"]
# NOTE: The `native` feature has been removed.
# For portable servers that run on both WASM and native, use two separate
# implementations:
# - WASM: Use `#[turbomcp_wasm::wasm_server]` macro for WASM targets
# - Native: Use `#[turbomcp::server]` macro from turbomcp for native targets

[dependencies]
# Core MCP types - no_std compatible with WASM optimizations
turbomcp-core = { workspace = true, default-features = false, features = ["wasm"] }

# MCP types for macro support (enables #[server] macro to work)
turbomcp-types = { workspace = true }

# Serialization
serde = { workspace = true }
serde_json = { workspace = true }

# Browser dependencies (optional)
wasm-bindgen = { version = "0.2.106", optional = true }
wasm-bindgen-futures = { version = "0.4", optional = true }
js-sys = { version = "0.3.83", optional = true }
serde-wasm-bindgen = { version = "0.6", optional = true }

# Async channel for WebSocket
futures-channel = { version = "0.3", optional = true }

# Console error panic hook for better debugging
console_error_panic_hook = { version = "0.1", optional = true }

# WASI Preview 2 dependencies (optional - for wasi feature)
wasi = { version = "0.14", optional = true }
wit-bindgen = { version = "0.39", optional = true }
url = { version = "2.5", optional = true }

# Cloudflare Workers SDK (optional - for cloudflare feature)
worker = { version = "0.7", optional = true }

# JSON Schema generation (optional - for cloudflare feature typed tools)
schemars = { version = "1.0", optional = true }

# HashMap for compatibility with turbomcp-core types (uses hashbrown for no_std)
hashbrown = { version = "0.15", optional = true }

# Procedural macros for zero-boilerplate WASM MCP server development
turbomcp-wasm-macros = { workspace = true, optional = true }

# Native MCP server (optional - for portable servers)
turbomcp = { workspace = true, optional = true }

[dependencies.web-sys]
version = "0.3.83"
optional = true
features = [
    "console",
    "Window",
    "Document",
    "Request",
    "RequestInit",
    "RequestMode",
    "Response",
    "Headers",
    "AbortController",
    "AbortSignal",
    "ReadableStream",
    "ReadableStreamDefaultReader",
    "Blob",
    "BlobPropertyBag",
    "FormData",
    "Url",
    "WebSocket",
    "BinaryType",
    "MessageEvent",
    "CloseEvent",
    "ErrorEvent",
    # Crypto features for JWT validation
    "Crypto",
    "CryptoKey",
    "CryptoKeyPair",
    "SubtleCrypto",
    "Algorithm",
    "RsaHashedImportParams",
    "EcKeyImportParams",
    "HmacImportParams",
    "JsonWebKey",
]

[dev-dependencies]
wasm-bindgen-test = "0.3"
tokio = { workspace = true, features = ["full"] }

# NOTE: The portable_server example has been removed since the native feature is gone.
# For portable servers, use conditional compilation with separate macro invocations.

[package.metadata.docs.rs]
targets = ["wasm32-unknown-unknown"]
all-features = true

[package.metadata.wasm-pack.profile.release]
wasm-opt = false  # Disable wasm-opt to avoid bulk memory errors with older toolchains

[package.metadata.wasm-pack.profile.dev]
wasm-opt = false
